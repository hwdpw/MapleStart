// 获取 DOM 元素
const searchInput = document.getElementById("searchInput");
const backgroundOverlay = document.getElementById("backgroundOverlay");
const title = document.getElementById("title");
const clock = document.getElementById("clock");
const engineToggle = document.getElementById("engineToggle");
const engineMenu = document.getElementById("engineMenu");
const body = document.body;

// 当前搜索引擎默认设置
let currentEngine = "bing";

// 搜索引擎列表，用于快捷键切换，顺序与 engineIcons 和 performSearch 保持一致
const engines = ["bing", "bilibili", "zhihu", "google", "stackoverflow", "github", "youtube", "wikipedia", "wolframalpha", "spotify"];

// 搜索引擎图标映射，SVG 图标用于动态切换显示
const engineIcons = {
  bing: '<svg t="1743148429730" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3113" width="200" height="200"><path d="M153.813333 0L358.4 71.936V791.893333l288.128-166.186666-141.226667-66.346667-89.173333-221.866667 453.973333 159.488v231.893334L358.528 1024l-204.672-113.92V0z" fill="#556adf" p-id="3114"></path></svg>',
  bilibili:
    '<svg viewBox="0 0 1129 1024" xmlns="http://www.w3.org/2000/svg"><path d="M234.909 9.656a80.468 80.468 0 0 1 68.398 0 167.374 167.374 0 0 1 41.843 30.578l160.937 140.82h115.07l160.936-140.82a168.983 168.983 0 0 1 41.843-30.578A80.468 80.468 0 0 1 930.96 76.445a80.468 80.468 0 0 1-17.703 53.914 449.818 449.818 0 0 1-35.406 32.187 232.553 232.553 0 0 1-22.531 18.508h100.585a170.593 170.593 0 0 1 118.289 53.109 171.397 171.397 0 0 1 53.914 118.288v462.693a325.897 325.897 0 0 1-4.024 70.007 178.64 178.64 0 0 1-80.468 112.656 173.007 173.007 0 0 1-92.539 25.75h-738.7a341.186 341.186 0 0 1-72.421-4.024A177.835 177.835 0 0 1 28.91 939.065a172.202 172.202 0 0 1-27.36-92.539V388.662a360.498 360.498 0 0 1 0-66.789A177.03 177.03 0 0 1 162.487 178.64h105.414c-16.899-12.07-31.383-26.555-46.672-39.43a80.468 80.468 0 0 1-25.75-65.984 80.468 80.468 0 0 1 39.43-63.57M216.4 321.873a80.468 80.468 0 0 0-63.57 57.937 108.632 108.632 0 0 0 0 30.578v380.615a80.468 80.468 0 0 0 55.523 80.469 106.218 106.218 0 0 0 34.601 5.632h654.208a80.468 80.468 0 0 0 76.444-47.476 112.656 112.656 0 0 0 8.047-53.109v-354.06a135.187 135.187 0 0 0 0-38.625 80.468 80.468 0 0 0-52.304-54.719 129.554 129.554 0 0 0-49.89-7.242H254.22a268.764 268.764 0 0 0-37.82 0z" fill="#20B0E3"/><path d="M348.369 447.404a80.468 80.468 0 0 1 55.523 18.507 80.468 80.468 0 0 1 28.164 59.547v80.468a80.468 80.468 0 0 1-16.094 51.5 80.468 80.468 0 0 1-131.968-9.656 104.609 104.609 0 0 1-10.46-54.719v-80.468a80.468 80.468 0 0 1 70.007-67.593z m416.02 0a80.468 80.468 0 0 1 86.102 75.64v80.468a94.148 94.148 0 0 1-12.07 53.11 80.468 80.468 0 0 1-132.773 0 95.757 95.757 0 0 1-12.875-57.133V519.02a80.468 80.468 0 0 1 70.007-70.812z" fill="#20B0E3"/></svg>',
  zhihu:
    '<svg t="1743070435170" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2611" width="200" height="200"><path d="M576.8 807.52h57.28l20.8 72.48 100.8-72.48h141.92V229.28H576.8z m67.84-513.92H832v448h-66.24l-85.12 64.96-18.56-64.96h-17.44zM126.4 884.48a149.44 149.44 0 0 0 123.84-10.4c60.96-36 105.92-194.56 105.92-194.56l144 177.44s13.12-84.48-2.24-108.32-99.04-119.84-99.04-119.84l-36.64 32 26.08-104.96H544s0-61.76-30.56-65.28-125.44 0-125.44 0v-192H528s-1.6-64-28.8-64H270.56l35.52-104.64s-57.6 3.36-77.92 39.36-86.4 221.6-86.4 221.6 21.92 10.24 59.2-17.28a147.68 147.68 0 0 0 49.28-75.52l67.84-3.36L320 491.2s-116.96-1.76-140.64 0-37.28 65.28-37.28 65.28H320s-15.2 108.16-60.96 187.2-132.64 140.8-132.64 140.8z" fill="#49C0FB" p-id="2612"></path></svg>',
  google:
    '<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M214.101333 512c0-32.512 5.546667-63.701333 15.36-92.928L57.173333 290.218667A491.861333 491.861333 0 0 0 4.693333 512c0 79.701333 18.858667 154.88 52.394667 221.610667l172.202667-129.066667A290.56 290.56 0 0 1 214.101333 512" fill="#FBBC05"/><path d="M516.693333 216.192c72.106667 0 137.258667 25.002667 188.458667 65.962667L854.101333 136.533333C763.349333 59.178667 646.997333 11.392 516.693333 11.392c-202.325333 0-376.234667 113.28-459.52 278.826667l172.373334 128.853333c39.68-118.016 152.832-202.88 287.146666-202.88" fill="#EA4335"/><path d="M516.693333 807.808c-134.357333 0-247.509333-84.864-287.232-202.88l-172.288 128.853333c83.242667 165.546667 257.152 278.826667 459.52 278.826667 124.842667 0 244.053333-43.392 333.568-124.757333l-163.584-123.818667c-46.122667 28.458667-104.234667 43.776-170.026666 43.776" fill="#34A853"/><path d="M1005.397333 512c0-29.568-4.693333-61.44-11.648-91.008H516.650667V614.4h274.602666c-13.696 65.962667-51.072 116.650667-104.533333 149.632l163.541333 123.818667c93.994667-85.418667 155.136-212.650667 155.136-375.850667" fill="#4285F4"/></svg>',
  stackoverflow:
    '<svg t="1743143262593" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14590" width="200" height="200"><path d="M620.714667 895.829333L213.376 896 213.333333 808.832l407.338667-0.213333 0.042667 87.210666zM896 402.133333L826.325333 0l-85.76 14.933333 69.674667 402.090667 85.76-14.933333z m-265.472 294.698667l-405.632-37.418667-7.978667 86.826667 405.632 37.376 7.978667-86.784z m26.752-113.749333l-393.386667-105.941334-22.613333 84.181334 393.429333 105.984 22.613334-84.224z m51.370667-99.712L357.76 276.053333 313.6 351.146667l350.890667 207.36 44.202666-75.093334z m86.016-61.013334l-229.504-337.237333-71.893334 49.066667 229.546667 337.237333 71.850667-49.066667z" fill="#FF810F" p-id="14591"></path><path d="M697.770667 597.333333v357.973334h-541.866667V597.333333H85.333333v426.666667h682.666667V597.333333z" fill="#BEBCBC" p-id="14592"></path></svg>',
  github:
    '<svg t="1743146014129" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15570" width="200" height="200"><path d="M465.981 1001.74a89.578 89.578 0 0 1-89.889-88.955l-0.356-63.666c-176.662 38.422-213.927-74.93-213.927-74.93-28.895-73.372-70.523-92.873-70.523-92.873-57.61-39.446 4.364-38.645 4.364-38.645 63.71 4.452 97.28 65.447 97.28 65.447 56.631 97.058 148.569 69.009 184.765 52.803 5.699-41.049 22.172-69.053 40.337-84.947-141.045-16.028-289.303-70.523-289.303-313.79 0-69.32 24.799-125.952 65.447-170.429-6.589-16.028-28.316-80.584 6.144-168.025 0 0 53.337-17.052 174.659 65.09a609.28 609.28 0 0 1 158.943-21.37c53.915 0.223 108.276 7.257 159.031 21.37C814.186 6.679 867.434 23.73 867.434 23.73c34.549 87.485 12.822 152.042 6.233 168.025 40.693 44.433 65.358 101.109 65.358 170.43 0 243.89-148.57 297.583-289.926 313.299 22.751 19.723 43.053 58.323 43.053 117.582 0 84.992-0.312 119.674-0.312 119.674a89.622 89.622 0 0 1-89.8 89H465.98z" fill="#46B980" p-id="15571"></path></svg>',
  youtube:
    '<svg viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path d="M1099.31 248.166c-12.562-47.3-49.574-84.552-96.568-97.194C917.562 128 576 128 576 128s-341.56 0-426.742 22.972c-46.994 12.644-84.006 49.894-96.568 97.194-22.824 85.734-22.824 264.61-22.824 264.61s0 178.876 22.824 264.61c12.562 47.3 49.574 83 96.568 95.642C234.44 896 576 896 576 896s341.56 0 426.742-22.972c46.994-12.642 84.006-48.342 96.568-95.642 22.824-85.734 22.824-264.61 22.824-264.61s0-178.876-22.824-264.61zM464.29 675.182V350.37l285.478 162.41L464.29 675.182z" fill="#ff0033"/></svg>',
  wikipedia:
    '<svg t="1740558225280" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3393" width="200" height="200"><path d="M530.077727 610.234325c-49.762357 97.384981-104.639199 199.047382-151.85864 295.595298-0.433882 0.433882-22.974247 0-22.974247-0.433882-71.867818-168.012551-147.146315-334.722434-219.044832-503.168868C118.774127 361.393887 60.486606 295.04476 20.521383 295.478641c0-4.681626-0.433882-15.315824-0.433882-21.703301l247.972675 0 0 21.269419c-29.360701 1.704828-80.827887 20.400632-66.349127 52.30425 33.608445 76.146261 158.6493 367.927697 192.257745 441.935248 22.974247-45.514613 88.455611-167.143765 115.27442-218.61095-21.269419-43.405579-89.757257-205.031677-111.460558-244.995877-14.881942-27.221991-55.281047-29.795607-85.478813-30.197766 0-6.821359 0-12.340049 0-21.269419l218.177068 0.403183 0 19.99745c-29.763884 0.867764-58.256822 11.905144-45.079708 39.995923 28.92682 61.23362 46.785559 104.205317 73.604368 160.354128 8.495488-16.587793 53.141314-106.34505 73.573669-154.401556 13.610996-31.469736-5.952572-43.808762-59.125609-45.080731 0.433882-5.54939 0-15.749706 0.433882-20.866237 68.053955-0.403183 170.120562-0.403183 188.413184-0.837064l0 20.834514c-34.44551 1.270946-70.162989 19.563568-88.889493 48.490388l-90.594321 188.010001c9.766434 24.679076 96.981798 218.61095 105.910145 239.880369l187.576119-432.571996c-13.177114-35.282574-55.714929-42.940998-72.301699-43.37488 0-5.51869 0-14.044878 0-21.269419l195.636702 1.704828 0.433882 0.837064-0.433882 18.726503c-42.940998 1.270946-68.892043 24.245194-85.478813 61.667501-38.290071 88.48631-158.246117 367.493815-237.772358 549.117362l-20.834514 0L530.077727 610.234325z" fill="#fefefe" p-id="3394"></path></svg>',
  wolframalpha:
    '<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48"><path fill="#EF5350" d="M16.924 21.593l-.386-7.861 7.507 2.794v7.263L16.924 21.593zM28.352 29.57L28.352 36.82 35.525 38.895 35.525 31.87z"></path><path fill="#EF9A9A" d="M24.045 35.975l-4.409-6.404 4.409-5.782 4.307 5.782L24.045 35.975zM19.636 10.712L23.994 5 28.352 10.966 24.045 16.525zM31.256 21.593L35.658 15.833 42.6 17.991 38.418 23.788z"></path><path fill="#D32F2F" d="M24.045 23.788l7.211-2.195 4.936 5.993-7.84 1.984L24.045 23.788zM16.924 21.593L12.387 15.663 5.179 18.032 9.494 23.788zM24.045 16.525L31.449 13.632 35.525 8.343 28.352 10.966z"></path><g><path fill="#B71C1C" d="M24.045 23.788v-7.263l7.404-2.894-.193 7.961L24.045 23.788zM19.636 29.57L19.636 36.863 12.387 38.895 12.387 31.912zM9.494 23.788L16.924 21.593 11.774 27.211 5 29.57z"></path></g><g><path fill="#660E0E" d="M16.924 21.593L12.387 15.663 12.208 8.343 16.538 13.731zM19.636 29.57L19.636 36.863 24.045 43 24.045 35.975zM28.352 29.57L36.191 27.586 43 29.57 35.525 31.87z"></path></g><g><path fill="#F44336" d="M31.256 21.593L35.658 15.833 35.525 8.343 31.449 13.632zM16.538 13.731L24.045 16.525 19.636 10.712 12.208 8.343zM28.352 29.57L28.352 36.82 24.045 43 24.045 35.975zM31.256 21.593L36.191 27.586 43 29.57 38.418 23.788z"></path></g><path fill="#8C1313" d="M12.387 31.912L19.636 29.57 11.774 27.211 5 29.57z"></path><path fill="#FFCDD2" d="M24.045,23.788l-4.409,5.782l-7.861-2.359l5.15-5.618L24.045,23.788z"></path></svg>',
  spotify:
    '<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48"><linearGradient id="tS~Tu1dsT5kMXF2Lct~HUa_G9XXzb9XaEKX_gr1" x1="24.001" x2="24.001" y1="-4.765" y2="56.31" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#4caf50"></stop><stop offset=".489" stop-color="#4aaf50"></stop><stop offset=".665" stop-color="#43ad50"></stop><stop offset=".79" stop-color="#38aa50"></stop><stop offset=".892" stop-color="#27a550"></stop><stop offset=".978" stop-color="#11a050"></stop><stop offset="1" stop-color="#0a9e50"></stop></linearGradient><path fill="url(#tS~Tu1dsT5kMXF2Lct~HUa_G9XXzb9XaEKX_gr1)" d="M24.001,4c-11.077,0-20,8.923-20,20s8.923,20,20,20c11.076,0,20-8.923,20-20	S35.077,4,24.001,4z"></path><path d="M21.224,15.938c5.554,0,11.4,1.17,15.785,3.654c0.584,0.293,1.022,0.877,1.022,1.754 c-0.145,1.023-0.877,1.755-1.899,1.755c-0.438,0-0.585-0.146-1.023-0.291c-3.508-2.047-8.769-3.217-13.885-3.217 c-2.631,0-5.262,0.293-7.6,0.877c-0.293,0-0.585,0.146-1.023,0.146c-0.075,0.011-0.149,0.016-0.221,0.016 c-0.905,0-1.533-0.821-1.533-1.77c0-1.023,0.585-1.607,1.315-1.754C14.939,16.231,17.862,15.938,21.224,15.938 M20.785,22.369 c4.97,0,9.793,1.17,13.593,3.507c0.584,0.291,0.877,0.877,0.877,1.461c0,0.878-0.585,1.608-1.462,1.608 c-0.438,0-0.73-0.144-1.023-0.291c-3.068-1.9-7.308-3.071-12.13-3.071c-2.339,0-4.531,0.293-6.139,0.733 c-0.439,0.144-0.585,0.144-0.877,0.144c-0.877,0-1.462-0.73-1.462-1.461c0-0.877,0.439-1.316,1.169-1.607 C15.523,22.808,17.716,22.369,20.785,22.369 M21.223,28.654c4.093,0,7.893,1.021,11.108,2.924 c0.438,0.291,0.731,0.584,0.731,1.314c-0.146,0.586-0.731,1.023-1.315,1.023c-0.292,0-0.585-0.145-0.877-0.292 c-2.777-1.607-6.139-2.484-9.792-2.484c-2.047,0-4.093,0.291-5.993,0.73c-0.292,0-0.731,0.146-0.877,0.146 c-0.731,0-1.169-0.586-1.169-1.17c0-0.73,0.438-1.17,1.023-1.314C16.4,28.945,18.739,28.654,21.223,28.654 M21.224,14.938 c-3.789,0-6.666,0.371-9.317,1.202c-1.254,0.279-2.06,1.341-2.06,2.722c0,1.553,1.112,2.77,2.533,2.77 c0.095,0,0.192-0.005,0.291-0.017c0.319-0.007,0.574-0.065,0.764-0.107c0.068-0.015,0.13-0.035,0.193-0.038h0.123l0.116-0.03 c2.219-0.554,4.763-0.847,7.358-0.847c5.073,0,10.075,1.152,13.381,3.081l0.09,0.053l0.099,0.033 c0.109,0.036,0.195,0.073,0.273,0.105c0.251,0.105,0.563,0.236,1.065,0.236c1.483,0,2.671-1.075,2.889-2.615l0.01-0.07v-0.071 c0-1.171-0.564-2.13-1.549-2.635C33.238,16.313,27.314,14.938,21.224,14.938L21.224,14.938z M20.785,21.369 c-3.291,0-5.651,0.508-7.711,1.057l-0.058,0.015l-0.055,0.022c-1.194,0.476-1.799,1.329-1.799,2.536 c0,1.357,1.104,2.461,2.462,2.461c0.371,0,0.626-0.009,1.189-0.194c1.572-0.429,3.714-0.683,5.827-0.683 c4.441,0,8.562,1.037,11.603,2.921l0.038,0.024l0.04,0.02c0.334,0.168,0.792,0.397,1.471,0.397c1.404,0,2.462-1.121,2.462-2.608 c0-0.996-0.53-1.886-1.387-2.334C31.04,22.659,26.04,21.369,20.785,21.369L20.785,21.369z M21.223,27.654 c-2.547,0-4.969,0.297-7.404,0.907c-1.096,0.27-1.78,1.145-1.78,2.284c0,1.217,0.953,2.17,2.169,2.17 c0.172,0,0.334-0.037,0.522-0.079c0.101-0.023,0.288-0.065,0.357-0.067l0.101-0.003l0.122-0.023 c2.023-0.467,3.963-0.704,5.768-0.704c3.422,0,6.635,0.812,9.291,2.35l0.025,0.015l0.026,0.013 c0.334,0.168,0.792,0.399,1.327,0.399c1.05,0,2.032-0.766,2.285-1.781l0.03-0.119v-0.123c0-1.202-0.595-1.76-1.178-2.147 l-0.022-0.014l-0.022-0.013C29.455,28.713,25.437,27.654,21.223,27.654L21.223,27.654z" opacity=".05"></path><path d="M21.224,15.938c5.554,0,11.4,1.17,15.785,3.654c0.584,0.293,1.022,0.877,1.022,1.754 c-0.145,1.023-0.877,1.755-1.899,1.755c-0.438,0-0.585-0.146-1.023-0.291c-3.508-2.047-8.769-3.217-13.885-3.217 c-2.631,0-5.262,0.293-7.6,0.877c-0.293,0-0.585,0.146-1.023,0.146c-0.075,0.011-0.149,0.016-0.221,0.016 c-0.905,0-1.533-0.821-1.533-1.77c0-1.023,0.585-1.607,1.315-1.754C14.939,16.231,17.862,15.938,21.224,15.938 M20.785,22.369 c4.97,0,9.793,1.17,13.593,3.507c0.584,0.291,0.877,0.877,0.877,1.461c0,0.878-0.585,1.608-1.462,1.608 c-0.438,0-0.73-0.144-1.023-0.291c-3.068-1.9-7.308-3.071-12.13-3.071c-2.339,0-4.531,0.293-6.139,0.733 c-0.439,0.144-0.585,0.144-0.877,0.144c-0.877,0-1.462-0.73-1.462-1.461c0-0.877,0.439-1.316,1.169-1.607 C15.523,22.808,17.716,22.369,20.785,22.369 M21.223,28.654c4.093,0,7.893,1.021,11.108,2.924 c0.438,0.291,0.731,0.584,0.731,1.314c-0.146,0.586-0.731,1.023-1.315,1.023c-0.292,0-0.585-0.145-0.877-0.292 c-2.777-1.607-6.139-2.484-9.792-2.484c-2.047,0-4.093,0.291-5.993,0.73c-0.292,0-0.731,0.146-0.877,0.146 c-0.731,0-1.169-0.586-1.169-1.17c0-0.73,0.438-1.17,1.023-1.314C16.4,28.945,18.739,28.654,21.223,28.654 M21.224,15.438 c-3.747,0-6.582,0.366-9.188,1.186c-1.042,0.222-1.689,1.078-1.689,2.238c0,1.273,0.893,2.27,2.033,2.27 c0.084,0,0.169-0.005,0.257-0.016c0.28-0.004,0.506-0.055,0.689-0.096c0.119-0.027,0.222-0.05,0.299-0.05h0.061l0.06-0.015 c2.258-0.564,4.844-0.862,7.479-0.862c5.158,0,10.254,1.177,13.633,3.149l0.045,0.026l0.05,0.016 c0.123,0.041,0.221,0.082,0.309,0.119c0.231,0.097,0.47,0.197,0.871,0.197c1.247,0,2.209-0.878,2.394-2.185l0.005-0.035v-0.035 c0-0.985-0.473-1.787-1.298-2.201C33.083,16.794,27.24,15.438,21.224,15.438L21.224,15.438z M20.785,21.869 c-3.054,0-5.24,0.416-7.583,1.04l-0.029,0.008l-0.028,0.011c-0.637,0.254-1.484,0.745-1.484,2.071c0,0.943,0.75,1.961,1.962,1.961 c0.34,0,0.541-0.008,1.033-0.169c1.637-0.447,3.827-0.708,5.983-0.708c4.533,0,8.747,1.064,11.867,2.996 c0.345,0.175,0.725,0.366,1.286,0.366c1.119,0,1.962-0.906,1.962-2.108c0-0.823-0.442-1.554-1.154-1.909 C30.885,23.141,25.965,21.869,20.785,21.869L20.785,21.869z M21.223,28.154c-2.506,0-4.888,0.292-7.283,0.892 c-0.864,0.213-1.401,0.902-1.401,1.799c0,0.821,0.624,1.67,1.669,1.67c0.116,0,0.246-0.029,0.411-0.067 c0.148-0.033,0.351-0.079,0.466-0.079h0.057l0.056-0.013c2.06-0.476,4.038-0.717,5.88-0.717c3.51,0,6.809,0.836,9.542,2.417 c0.331,0.168,0.712,0.359,1.127,0.359c0.827,0,1.601-0.603,1.8-1.402l0.015-0.06v-0.061c0-1.012-0.493-1.424-0.954-1.73 C29.277,29.189,25.348,28.154,21.223,28.154L21.223,28.154z" opacity=".07"></path><path fill="#fff" d="M31.747,33.915c-0.292,0-0.585-0.145-0.877-0.292c-2.777-1.607-6.139-2.484-9.792-2.484 c-2.047,0-4.093,0.291-5.993,0.73c-0.292,0-0.731,0.146-0.877,0.146c-0.731,0-1.169-0.586-1.169-1.17 c0-0.73,0.438-1.17,1.023-1.314c2.338-0.586,4.677-0.877,7.161-0.877c4.093,0,7.893,1.021,11.108,2.924 c0.438,0.291,0.731,0.584,0.731,1.314C32.916,33.478,32.331,33.915,31.747,33.915z M33.793,28.945c-0.438,0-0.73-0.144-1.023-0.291 c-3.068-1.9-7.308-3.071-12.13-3.071c-2.339,0-4.531,0.293-6.139,0.733c-0.439,0.144-0.585,0.144-0.877,0.144 c-0.877,0-1.462-0.73-1.462-1.461c0-0.877,0.439-1.316,1.169-1.607c2.192-0.584,4.385-1.023,7.454-1.023 c4.97,0,9.793,1.17,13.593,3.507c0.584,0.291,0.877,0.877,0.877,1.461C35.255,28.215,34.67,28.945,33.793,28.945z M36.132,23.101 c-0.438,0-0.585-0.146-1.023-0.291c-3.508-2.047-8.769-3.217-13.885-3.217c-2.631,0-5.262,0.293-7.6,0.877 c-0.293,0-0.585,0.146-1.023,0.146c-1.023,0.146-1.754-0.73-1.754-1.754c0-1.023,0.585-1.607,1.315-1.754 c2.777-0.877,5.7-1.17,9.062-1.17c5.554,0,11.4,1.17,15.785,3.654c0.584,0.293,1.022,0.877,1.022,1.754 C37.886,22.369,37.154,23.101,36.132,23.101z"></path></svg>',
};

/**
 * 更新背景图片，根据时间切换早晚背景
 */
function updateBackground() {
  const hour = new Date().getHours();
  const isMorning = hour >= 6 && hour < 18;
  body.style.background = isMorning ? 'url("img/bglyxz.png") no-repeat center/cover fixed' : 'url("img/bghsseyewj.jpg") no-repeat center/cover fixed';
  backgroundOverlay.style.background = isMorning ? 'url("img/bgxifumn.png") no-repeat center/cover' : 'url("img/bgxifumn.png") no-repeat center/cover';
}

/**
 * 更新搜索引擎图标，显示当前选中的引擎图标
 */
function updateEngineIcon() {
  engineToggle.innerHTML = engineIcons[currentEngine];
}

/**
 * 执行搜索，打开新窗口跳转到当前搜索引擎的搜索结果页
 */
function performSearch() {
  const query = encodeURIComponent(searchInput.value.trim());
  if (!query) {
    console.log("Empty query, search aborted"); // 调试：确认空输入不搜索
    return;
  }
  const engines = {
    bing: `https://www.bing.com/search?q=${query}`,
    bilibili: `https://search.bilibili.com/all?keyword=${query}`,
    zhihu: `https://www.zhihu.com/search?type=content&q=${query}`,
    google: `https://www.google.com/search?q=${query}`,
    stackoverflow: `https://stackoverflow.com/search?q=${query}`,
    github: `https://github.com/search?q=${query}`,
    youtube: `https://www.youtube.com/results?search_query=${query}`,
    wikipedia: `https://en.wikipedia.org/wiki/Special:Search?search=${query}`,
    wolframalpha: `https://www.wolframalpha.com/input?i=${query}`,
    spotify: `https://open.spotify.com/search/${query}`,
  };
  console.log("Opening search URL:", engines[currentEngine]); // 调试：确认搜索URL
  window.open(engines[currentEngine], "_blank");
  searchInput.value = ""; // 清空输入框
  searchInput.blur(); // 搜索后退出聚焦
}
/**
 * 更新时钟显示，格式为 HH:MM:SS
 */
function updateClock() {
  clock.textContent = new Date().toTimeString().slice(0, 8);
}

// 输入框聚焦时显示背景叠加层
searchInput.addEventListener("focus", () => {
  backgroundOverlay.style.opacity = "1";
});

// 输入框失焦时隐藏背景叠加层
searchInput.addEventListener("blur", () => {
  console.log("Blur event triggered, setting overlay opacity to 0"); // 调试：确认失焦
  backgroundOverlay.style.opacity = "0";
});

// 按下 Enter 键执行搜索（仅在聚焦时生效）
searchInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    e.preventDefault(); // 防止浏览器默认行为
    const query = searchInput.value.trim();
    if (query) {
      console.log("Performing search with query:", query); // 调试：确认搜索触发
      performSearch();
    } else {
      console.log("Input is empty, blurring input"); // 调试：确认空输入失焦
      searchInput.blur(); // 触发失焦
      // 强制确保失焦
      setTimeout(() => {
        if (document.activeElement === searchInput) {
          console.log("Input still focused, forcing blur"); // 调试：确认强制失焦
          searchInput.blur();
        }
      }, 0);
    }
  }
});

// 点击切换按钮显示/隐藏搜索引擎菜单
engineToggle.addEventListener("click", () => {
  engineMenu.style.display = engineMenu.style.display === "block" ? "none" : "block";
});

// 点击菜单选项切换搜索引擎
engineMenu.addEventListener("click", (e) => {
  if (e.target.classList.contains("engine-option")) {
    currentEngine = e.target.getAttribute("data-engine");
    updateEngineIcon();
    engineMenu.style.display = "none";
  }
});

// 点击页面其他区域隐藏菜单
document.addEventListener("click", (e) => {
  if (!engineToggle.contains(e.target) && !engineMenu.contains(e.target)) {
    engineMenu.style.display = "none";
  }
});

document.addEventListener("keydown", (e) => {
  // Alt + 0 到 Alt + 9 切换搜索引擎
  if (e.altKey && e.key >= "0" && e.key <= "9") {
    const index = e.key === "0" ? 9 : parseInt(e.key) - 1; // "0"映射到索引9，其他减1
    if (index < engines.length) {
      currentEngine = engines[index];
      updateEngineIcon();
      console.log("Switched to engine:", currentEngine); // 调试：确认引擎切换
    }
  }
  // Enter 未聚焦时仅聚焦输入框
  if (e.key === "Enter" && document.activeElement !== searchInput) {
    e.preventDefault(); // 防止触发浏览器默认行为
    console.log("Global Enter pressed, focusing input"); // 调试：确认全局回车
    searchInput.focus(); // 仅聚焦输入框
  }
});

// 初始加载时隐藏标题，显示时钟
setTimeout(() => {
  title.style.display = "none";
  clock.style.display = "block";
}, 600);

// 获取一言并显示
fetch("https://v1.hitokoto.cn")
  .then((res) => res.json())
  .then((data) => {
    document.getElementById("quote").textContent = `${data.hitokoto} —— ${data.from}`;
  });

// 初始化背景和图标
updateBackground();
updateEngineIcon();

// 每秒更新时钟和背景
setInterval(() => {
  updateClock();
  updateBackground();
}, 1000);
